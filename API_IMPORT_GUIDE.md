# API导入功能使用指南

## 概述

新的API导入功能支持两种导入方式：
1. **详细表单导入** - 通过可视化表单逐步填写API信息
2. **Swagger JSON导入** - 批量导入Swagger/OpenAPI格式的API文档

## 主要特性

### 🎯 完整的API信息支持
- **基本信息**: 名称、描述、路径、HTTP方法、版本、分类
- **请求信息**: 请求头、请求体、请求参数
- **响应信息**: 响应头、响应体
- **多层嵌套JSON**: 支持复杂的JSON结构展示和编辑

### 📊 两种视图模式
- **表格视图**: 以表格形式展示JSON结构，支持嵌套层级展开/折叠
- **JSON视图**: 传统的JSON文本编辑器

### 🔧 强大的编辑功能
- **实时编辑**: 支持在线编辑JSON字段
- **字段管理**: 添加、删除、修改JSON字段
- **类型识别**: 自动识别数据类型（string、number、boolean、object、array）
- **嵌套支持**: 完整支持多层嵌套的JSON结构

## 使用方法

### 方式一：详细表单导入

1. **打开导入对话框**
   - 在API目录页面点击"导入API"按钮
   - 选择"详细表单导入"标签页

2. **填写基本信息**
   ```
   - API名称: 必填，API的显示名称
   - HTTP方法: GET/POST/PUT/DELETE/PATCH/HEAD/OPTIONS
   - API路径: 必填，如 /api/v1/users/{id}
   - 版本: API版本号，默认1.0.0
   - 分类/子分类: 用于API分组管理
   - 描述: 支持富文本编辑
   ```

3. **配置请求信息**
   - **请求头**: 添加Authorization、Content-Type等头信息
   - **请求参数**: 定义查询参数、路径参数等
   - **请求体**: 使用表格或JSON编辑器定义请求数据结构

4. **配置响应信息**
   - **响应头**: 定义响应头信息
   - **响应体**: 定义返回数据的JSON结构

5. **JSON结构编辑**
   - 切换到"表格视图"可以看到结构化的JSON编辑界面
   - 点击展开/折叠图标查看嵌套结构
   - 使用"编辑"按钮修改字段值
   - 使用"添加字段"按钮增加新字段
   - 使用"删除"按钮移除不需要的字段

### 方式二：Swagger JSON导入

1. **准备Swagger文档**
   - 确保JSON格式正确
   - 包含完整的paths定义
   - 建议包含example数据

2. **导入步骤**
   - 选择"Swagger JSON导入"标签页
   - 粘贴或输入Swagger JSON内容
   - 点击"导入API"按钮

3. **自动解析内容**
   - 自动提取API路径和方法
   - 解析请求参数和响应结构
   - 提取示例数据作为默认值
   - 创建对应的血缘关系数据

## JSON表格视图详解

### 表格列说明
- **字段名**: JSON中的键名，支持嵌套显示
- **值**: 字段的值，复杂对象显示为摘要
- **类型**: 数据类型，用不同颜色标识
- **操作**: 编辑、删除、添加子字段、复制等操作

### 嵌套结构处理
```json
{
  "user": {
    "profile": {
      "contact": {
        "email": "user@example.com",
        "phone": "13800138000"
      },
      "skills": ["JavaScript", "React", "Node.js"]
    }
  }
}
```

在表格视图中会显示为：
```
├─ user (object)
│  └─ profile (object)
│     ├─ contact (object)
│     │  ├─ email: "user@example.com" (string)
│     │  └─ phone: "13800138000" (string)
│     └─ skills (array)
│        ├─ [0]: "JavaScript" (string)
│        ├─ [1]: "React" (string)
│        └─ [2]: "Node.js" (string)
```

### 编辑操作
1. **编辑字段值**: 点击编辑图标，在弹出的编辑框中修改
2. **添加字段**: 点击"添加字段"按钮，输入字段名称
3. **删除字段**: 点击删除图标，确认后删除
4. **添加子字段**: 对于object类型，可以添加子字段
5. **复制值**: 点击复制图标，复制字段值到剪贴板

## 示例Swagger JSON

项目根目录下的`example-swagger.json`文件包含了一个完整的示例，包括：
- 用户列表查询API（带分页和筛选）
- 用户创建API（复杂的嵌套请求体）
- 用户详情查询API（复杂的嵌套响应）
- 用户更新和删除API

## 最佳实践

### 1. 数据结构设计
- 保持JSON结构清晰，避免过深的嵌套
- 使用有意义的字段名
- 为复杂字段添加描述信息

### 2. 请求/响应设计
- 请求头包含必要的认证和内容类型信息
- 响应体包含成功标识、数据和消息字段
- 错误响应包含错误码和详细信息

### 3. 参数定义
- 明确标识必填和可选参数
- 提供参数的类型和格式说明
- 包含实际的示例值

### 4. 版本管理
- 为API设置合适的版本号
- 在路径中体现版本信息
- 保持向后兼容性

## 故障排除

### 常见问题

1. **JSON解析失败**
   - 检查JSON格式是否正确
   - 确保所有括号和引号匹配
   - 使用JSON验证工具检查

2. **Swagger导入失败**
   - 确保包含`paths`字段
   - 检查Swagger版本兼容性
   - 验证必要字段是否存在

3. **表格视图显示异常**
   - 刷新页面重试
   - 检查数据是否包含循环引用
   - 简化复杂的嵌套结构

### 技术支持

如果遇到问题，请检查：
1. 浏览器控制台是否有错误信息
2. 网络连接是否正常
3. 数据格式是否符合要求

## 更新日志

### v2.0.0 (当前版本)
- ✨ 新增表格视图模式
- ✨ 支持复杂JSON嵌套结构编辑
- ✨ 增强的请求/响应配置
- ✨ 改进的Swagger解析能力
- 🐛 修复了多个已知问题
- 🎨 优化了用户界面和交互体验 