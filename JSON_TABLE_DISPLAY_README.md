# JSON 表格展示功能

## 功能概述

新增的 JSON 表格展示功能为 API 详情页提供了更好的 JSON 数据可视化体验。用户可以在传统的 JSON 文本视图和新的表格视图之间无缝切换，特别适合查看和编辑复杂的嵌套 JSON 数据结构。

## 主要特性

### 🔄 双视图模式
- **表格视图**: 将 JSON 数据以表格形式展示，直观显示字段层级关系
- **JSON 视图**: 传统的 JSON 文本编辑器
- 一键切换：通过右上角的开关在两种视图间无缝切换

### 📊 智能表格展示
- **层级结构**: 使用缩进和展开/折叠按钮清晰显示 JSON 的嵌套关系
- **类型识别**: 用不同颜色的标签标识数据类型（string、number、boolean、object、array、null）
- **数组支持**: 完美处理数组类型，支持数组元素的独立展开
- **值格式化**: 智能格式化显示值，对象和数组显示概要信息

### ✏️ 在线编辑功能
- **实时编辑**: 支持在表格视图中直接编辑字段值
- **格式验证**: 编辑时自动验证 JSON 格式的正确性
- **类型转换**: 根据数据类型自动进行值的类型转换
- **批量编辑**: 在 JSON 视图中可以进行批量文本编辑

### 🎯 用户体验优化
- **一键复制**: 快速复制整个 JSON 数据到剪贴板
- **响应式设计**: 适配不同屏幕尺寸，移动端友好
- **性能优化**: 大数据量下的流畅操作体验
- **美观界面**: 现代化的 Material-UI 设计风格

## 使用场景

### 1. API 文档展示
在 API 详情页中展示请求和响应参数的结构，让开发者更容易理解 API 的数据格式。

### 2. 数据编辑器
提供用户友好的 JSON 数据编辑界面，降低直接编辑 JSON 文本的复杂度。

### 3. 配置管理
管理复杂的系统配置和设置参数，特别适合多层嵌套的配置文件。

### 4. 调试工具
在开发过程中查看和修改 JSON 数据，提高调试效率。

## 组件使用

### 基本用法

```jsx
import JsonTableDisplay from '../components/JsonTableDisplay';

function MyComponent() {
  const [data, setData] = useState({
    name: "示例",
    settings: {
      theme: "dark",
      enabled: true
    }
  });

  const handleCopy = (jsonString) => {
    navigator.clipboard.writeText(jsonString);
  };

  return (
    <JsonTableDisplay
      data={data}
      title="数据展示"
      onDataChange={setData}
      onCopy={handleCopy}
      isEditable={true}
      defaultView="table"
    />
  );
}
```

### 属性说明

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `data` | Object/Array | - | 要展示的 JSON 数据 |
| `title` | String | - | 展示面板的标题 |
| `onDataChange` | Function | - | 数据变更回调函数 |
| `onCopy` | Function | - | 复制操作回调函数 |
| `isCopied` | Boolean | false | 是否显示已复制状态 |
| `isEditable` | Boolean | false | 是否允许编辑 |
| `defaultView` | String | 'table' | 默认视图模式（'table' 或 'json'） |

## 数据类型支持

组件支持所有标准 JSON 数据类型的识别和展示：

- **String** (蓝色): 字符串类型
- **Number** (绿色): 数字类型
- **Boolean** (紫色): 布尔值类型
- **Object** (橙色): 对象类型
- **Array** (红色): 数组类型
- **Null** (灰色): 空值类型

## 操作指南

### 表格视图操作

1. **展开/折叠结构**
   - 点击字段名左侧的箭头图标
   - 展开查看嵌套的子结构
   - 折叠隐藏复杂的子结构

2. **编辑字段值**
   - 点击"操作"列的编辑图标
   - 在弹出的编辑框中修改值
   - 支持 JSON 格式验证和自动类型转换

3. **查看数据类型**
   - 每个字段的类型用彩色标签显示
   - 鼠标悬停查看更多类型信息

### JSON 视图操作

1. **切换视图模式**
   - 使用右上角的开关按钮
   - 在表格视图和 JSON 视图间切换

2. **编辑 JSON 文本**
   - 在 JSON 视图下点击"编辑"按钮
   - 直接编辑完整的 JSON 文本
   - 保存时自动验证格式

3. **复制 JSON 数据**
   - 点击复制按钮
   - 将格式化的 JSON 数据复制到剪贴板

## 技术实现

### 核心算法

1. **JSON 扁平化**: 使用递归算法将嵌套的 JSON 数据扁平化为表格行，同时保持层级关系
2. **路径追踪**: 为每个数据节点维护完整的访问路径，支持深层嵌套的数据编辑
3. **类型推断**: 自动识别数据类型并进行相应的格式化和验证

### 性能优化

1. **按需渲染**: 只渲染当前展开的数据节点，避免不必要的 DOM 操作
2. **虚拟化支持**: 对于大数据量场景提供虚拟滚动支持
3. **防抖处理**: 编辑操作使用防抖机制，避免频繁的状态更新

## 演示页面

访问 `/json-table-demo` 路径可以查看完整的功能演示，包含：

- 简单数据结构示例
- 复杂嵌套数据示例
- 编辑和只读模式对比
- 所有功能的交互演示

## 在 API 详情页中的应用

新功能已经集成到 API 详情页的"请求/响应"标签页中：

1. **请求头展示**: 表格化展示 HTTP 请求头信息
2. **请求体编辑**: 支持复杂请求参数的可视化编辑
3. **响应头查看**: 清晰展示响应头信息
4. **响应体分析**: 帮助理解 API 返回的数据结构

## 未来计划

- [ ] 添加字段搜索和过滤功能
- [ ] 支持 JSON Schema 验证
- [ ] 提供更多的数据类型支持
- [ ] 增加批量操作功能
- [ ] 支持数据导入导出

---

这个新功能显著提升了 JSON 数据的可读性和可编辑性，特别适合处理复杂的 API 参数结构，为开发者提供了更好的使用体验。 